define(['text!templates/bookpattern.html'],function(template){Vue.component('bookpattern',{template:template,props:['category','query','app-id','api-key','index-name','add-margin','pattern-index'],data:function(){return{hits:[],defaultHitCount:6,defaultPage:1,positionsArray:[[{'top':'0px','left':'55%','transform':'rotate(-10deg)'},{'top':'55px','left':'60%','transform':'rotate(20deg)'},{'top':'20px','left':'70%','transform':'rotate(-9deg)'},{'top':'-20px','left':'75%','transform':'rotate(-3deg)'},{'top':'50px','left':'81%','transform':'rotate(3deg)'},{'top':'25px','left':'87%','transform':'rotate(15deg)'}],[{'display':'none'},{'display':'none'},{'display':'none','top':'120px','left':'55%','transform':'rotate(-9deg)'},{'top':'-10px','left':'65%','transform':'rotate(-3deg)'},{'top':'90px','left':'67%','transform':'rotate(8deg)'},{'display':'none'}]]};},computed:{positions:function(){if(this.patternIndex)
return this.positionsArray[this.patternIndex];return this.positionsArray[0];}},methods:{getCategoryLevel:function(){var lvl=this.category.match(/>/g);if(lvl)
return lvl.length;return 0;},getItems:function(){var self=this;var client=algoliasearch(self.appId,self.apiKey);var index=client.initIndex(self.indexName);var filterString=(self.category)?"Categories.lvl"+self.getCategoryLevel()+":\""+self.category+"\" AND Websites:"+bwb.store.state.siteId:"Websites:"+bwb.store.state.siteId;index.search({query:self.query,page:((self.category&&self.category.length>0)||(self.query&&self.query.length>0))?self.defaultPage:0,hitsPerPage:self.defaultHitCount,filters:filterString}).then(function(result){if(result&&result.hits.length){$.each(result.hits,function(i,v){var delay=200*i;setTimeout(function(){self.hits.push(v);},delay);});}});},getImageUrl:function(hit){return bwb.product.buildProductImageUrl(hit.ImageURL);},getPosition:function(index){return this.positions[index];},getDetailUrl:function(hit){return bwb.product.getDetailUrl(hit.Title,hit.Isbn13);},adjustPostions:function(){for(var x=0;x<this.defaultHitCount;x++){if(this.positions[x].top)
this.positions[x].top=+this.positions[x].top.replace('px','')+ +this.addMargin+'px';}}},mounted:function(){if(this.addMargin)
this.adjustPostions();this.getItems();}});});