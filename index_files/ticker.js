define(['text!templates/ticker.html'],function(template){Vue.component('ticker',{template:template,data:function(){return{ready:false,booksDonatedDisplay:0,fundsRaisedDisplay:0,wasteSavedDisplay:0,model:null,currencySymbol:'$'};},computed:{booksDonatedFormatted:function(){return bwb.helpers.formatNumber(this.booksDonatedDisplay,0,',','','','','','');},fundsRaisedFormatted:function(){return bwb.helpers.formatNumber(this.fundsRaisedDisplay,0,',','',this.currencySymbol,'','','');},wasteSavedFormatted:function(){return bwb.helpers.formatNumber(this.wasteSavedDisplay,0,',','','','','','')}},methods:{run:function(){var self=this;$.ajax({url:'/Home/GetTickerValues',type:'POST',}).done(function(model){self.model=model;self.ready=true;self.tick('booksDonatedDisplay',self.model.BooksDonated,self.model.BooksDonatedProjected);self.tick('fundsRaisedDisplay',self.model.Donations,self.model.DonationsProjected);self.tick('wasteSavedDisplay',self.model.BooksSaved,self.model.BooksSavedProjected);});},tick:function(keyname,initialValue,projectedValue){var self=this;var Digital=new Date();var date1=new Date();var date2=new Date();var date1temp=new Date(self.model.StartDate);var date2temp=new Date(self.model.StopDate);date1.setTime(date1temp.getTime());date2.setTime(date2temp.getTime());Digital.setTime(Math.abs(date2.getTime()-date1.getTime()));timediff=Digital.getTime();secs=timediff/1000;Rate=(projectedValue-initialValue)/secs;var curr_date=new Date();var timezone=curr_date.getTimezoneOffset()/60;hours=curr_date.getTimezoneOffset()/60;minutes=curr_date.getTimezoneOffset()%60;if(timezone>5)
curr_date.setHours(curr_date.getHours()+(hours-5),curr_date.getMinutes()+minutes);if(timezone<5)
curr_date.setHours(curr_date.getHours()-(5-hours),curr_date.getMinutes()-minutes);if(date2.getTime()>=curr_date.getTime())
curr_sec=Math.abs(curr_date.getTime()-date1.getTime())/1000;else
curr_sec=secs;self[keyname]=initialValue+(Rate*curr_sec);setTimeout(function(){self.tick(keyname,initialValue,projectedValue);},Math.floor((Math.random()*10)+3)*1000);}},mounted:function(){this.run();}});});