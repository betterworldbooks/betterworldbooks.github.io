(function(){bwb.ignoreparams=!0;require(["comps/categoryRow","comps/curatedRow","comps/gridBook","comps/htmlRow","comps/jumbotron","comps/bookPattern","comps/reviewRow","comps/readerReview"],function(){bwb.detailApp=new Vue({el:"#detailApp",data:{sharedState:bwb.store.state,previewUnavailable:!1,loadingPreview:!1,processingAddToCart:!1,cartMessage:null,localize:bwb.localize.siteSettings,showBorrow:!1,showWaitList:!1,showPreviewBtn:!1,iaID:"",showBorrowRow:!1},computed:{CartName:function(){return bwb.localize.siteSettings.CartName},isUS:function(){return bwb.localize.siteSettings.CountryCode!=="US"},showSavings:function(){return this.sharedState.cartCurrency==="USD"}},methods:{setPreviewBtn:function(){this.sharedState.detailObject.InternetArchiveID&&(this.showPreviewBtn=!0)},isbn13to10:function(n){var u,r,t=0,f="";for(u=n.substring(3,n.length),i=10;i>1;i--)r=u.charAt(10-i),t+=(+r)*i,f+=r;return t=(11-t%11)%11,f+(t==10?"X":t+"")},hitApi:function(){var n=this,t=this.isbn13to10(this.sharedState.detailObject.Isbn);console.log("ID for IA: "+this.sharedState.detailObject.InternetArchiveID);$.ajax({url:url="https://archive.org/services/availability?isbn="+t}).done(function(i){n.iaID=i.responses[t].identifier;console.log(n.iaID);i.responses[t].status=="borrow_unavailable"?(n.showWaitList=!0,n.showBorrowRow=!0,n.setPreviewBtn()):i.responses[t].status=="error"?n.showPreviewBtn=!1:(n.showBorrow=!0,n.showBorrowRow=!0,n.setPreviewBtn())})},borrowBook:function(){var n="https://archive.org/details/"+this.iaID;window.open(n,"_blank")},initGooglePreviewViewer:function(){var n=document.getElementById("google-preview"),t;n&&(this.loadingPreview=!0,n.style.height=window.innerHeight*.8+"px",t=new google.books.DefaultViewer(n),t.load("ISBN:"+this.sharedState.detailObject.Isbn,this.setPreviewUnavailable,this.setPreviewLoaded))},showInternetArchivePreview:function(){var n=document.getElementById("ia-preview");n&&(this.loadingPreview=!0,n.style.height=window.innerHeight*.8+"px",this.sharedState.detailObject.InternetArchiveID!==""?this.setPreviewLoaded():this.setPreviewUnavailable())},setPreviewUnavailable:function(){this.loadingPreview=!1;this.previewUnavailable=!0},setPreviewLoaded:function(){this.loadingPreview=!1},showSyndeticsPreview:function(){return $syndetics.open_unbound_lightbox("https://syndetics.com/unbound_lightbox.php?active_id=excerpt&enhancement=unbound_lookinside&id=bwbooks&isbn="+this.sharedState.detailObject.Isbn+"&issn=&market=65031971&oclc=&upc=",this),!1},addToCart:function(n){var t=this;n&&n.preventDefault();var r=this.sharedState.detailObject.Isbn,u=$(n.target).attr("data-inventoryid"),f=$(n.target).attr("data-marketplace"),i=$(n.target).attr("data-price"),e=$(n.target).attr("data-condition");t.processingAddToCart=!0;$(".cart-modal").modal("show");$.post("/Services/AddToCart.aspx",{inventoryId:u,marketPlace:f,IsSteb:!1},function(n){n.StatusCode==="200"?(dataLayer.push({cartProdID:r}),dataLayer.push({cartPrice:i}),dataLayer.push({event:"addcart"}),bwb.cart.getCartCount(),n.Url&&n.Url.length>0?(t.cartMessage="<h3><em>'"+t.sharedState.detailObject.Title+"'<\/em> has been added to your "+t.CartName+"!<\/h3>",t.cartMessage+='<div class="row"><div class="col-xs-12 col-sm-6 col-sm-offset-3 text-left">',t.cartMessage+='<dl class="dl-horizontal">',t.cartMessage+="    <dt>Condition<\/dt>",t.cartMessage+="    <dd>"+e+"<\/dd>",t.cartMessage+="    <dt>Price<\/dt>",t.cartMessage+="    <dd>"+t.localize.CurrencySymbol+i+"<\/dd>",t.cartMessage+="<\/dl>",t.cartMessage+="<\/div><\/div>"):t.cartMessage=n.Message.replace(/<a/g,'<a class="hidden"')):t.cartMessage=n.Message.replace(/<a/g,'<a class="hidden"');t.processingAddToCart=!1},"json")},getRatingStars:function(n){return bwb.product.getRatingStars(n)},defaultCheck:function(n){var i=this.sharedState.detailObject.Isbn,r,t;bwb.store.state.useOpenLibraryImages&&i.startsWith("9")&&(r=bwb.product.defaultImageCheck(n.target),r===!1&&n.target.src&&n.target.src.indexOf("openlibrary.org")>-1&&(t=$(".courtesyLink"),t&&t.css("visibility","visible"),bwb.product.logMissingImage(i)))}},watch:{"sharedState.zoneId":function(){window.location.reload()},"sharedState.cartCurrency":function(){window.location.reload()}},mounted:function(){this.sharedState.allowAllCookies&&typeof google!==undefined&&google.books.load();bwb.ignoreparams=!1;this.hitApi()}})})})()