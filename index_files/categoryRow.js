define(['text!templates/categoryRow.html'],function(template){Vue.component('categoryrow',{template:template,props:['category','name','description','app-id','api-key','index-name','hit-count','category-page-url','query','show-new-only','auto-rotate','exclude-isbn'],data:function(){return{defaultHitCount:6,page:0,lastPage:0,hits:[],transitionInNext:"animated fadeInRightBig",transitionOutNext:"animated fadeOutLeftBig",transitionInPrev:"animated fadeInLeftBig",transitionOutPrev:"animated fadeOutRightBig",transitionInNextMobile:"animated fadeInRight",transitionOutNextMobile:"animated fadeOutLeft",transitionInPrevMobile:"animated fadeInLeft",transitionOutPrevMobile:"animated fadeOutRight",mobileTransitionWidth:1440,localize:bwb.localize.siteSettings,autoRotateTimer:0,autoRotateTimeout:null,hideMe:false};},methods:{getCategoryLevel:function(){var lvl=this.category.match(/>/g);if(lvl)
return lvl.length;return 0;},getItems:function(){var self=this;var client=algoliasearch(self.appId,self.apiKey);var index=client.initIndex(self.indexName);var onlyNewFilter=(self.showNewOnly)?" AND AvailableCopies.IsNew:true":"";var excludeIsbnFilter=(self.excludeIsbn)?" AND (NOT Isbn13:\""+self.excludeIsbn+"\")":"";var filterString=(self.category)?"Categories.lvl"+self.getCategoryLevel()+":\""+self.category+"\" AND Websites:"+bwb.store.state.siteId:"Websites:"+bwb.store.state.siteId;filterString+=excludeIsbnFilter;filterString+=onlyNewFilter;index.search({query:self.query,page:self.page,hitsPerPage:self.hitCount?self.hitCount:self.defaultHitCount,filters:filterString}).then(function(result){if(result&&result.hits.length){self.hits=result.hits;}else if(!result||!result.hits.length){self.hideMe=true;}});if(self.autoRotateTimer){self.autoRotateTimeout=setTimeout(function(){self.setPage(self.page+1)},self.autoRotateTimer);}},setPage:function(newPage,disableRotate){if(disableRotate){this.disableAutoRotate();}
this.lastPage=this.page;this.page=newPage;this.getItems();},disableAutoRotate:function(){this.autoRotateTimer=0;clearTimeout(this.autoRotateTimeout);},getTransitionIn:function(){var windowWidth=$(window).width();if(this.lastPage<this.page){return windowWidth>=this.mobileTransitionWidth?this.transitionInNext:this.transitionInNextMobile;}else if(this.lastPage>this.page){return windowWidth>=this.mobileTransitionWidth?this.transitionInPrev:this.transitionInPrevMobile;}else{return "";}},getTransitionOut:function(){var windowWidth=$(window).width();if(this.lastPage<this.page){return windowWidth>=this.mobileTransitionWidth?this.transitionOutNext:this.transitionOutNextMobile;}else if(this.lastPage>this.page){return windowWidth>=this.mobileTransitionWidth?this.transitionOutPrev:this.transitionOutPrevMobile;}else{return "";}},setupGestures:function(){var self=this;var mc=new Hammer(document.getElementById(self.rowId));mc.on("panstart",function(e){if(e.additionalEvent=="panleft")
self.setPage(self.page+1,true);else if(e.additionalEvent=="panright"&&self.page>=1)
self.setPage(self.page-1,true);});}},computed:{displayText:function(){return(!this.name)?this.category:this.name;},categoryId:function(){return bwb.helpers.dashify((this.category)?this.category:this.name);},rowId:function(){return "category-row-"+this.categoryId;}},mounted:function(){var self=this;if(self.autoRotate)
self.autoRotateTimer=self.autoRotate;self.getItems();self.setupGestures();},created:function(){var self=this;bwb.bus.$on('gridBook-addToCart-click',function(category){if(self.categoryId==category)
self.disableAutoRotate();});}});});